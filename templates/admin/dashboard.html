{% extends "base.html" %}
{% block content %}

<h2 class="mt-3 mb-3">Admin Dashboard</h2>
<div class="card p-3 mb-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Welcome Admin</h4>
            <form method="GET" action="{{ url_for('doctor_search') }}" class="d-flex" style="gap:8px;">
            <input type="text" name="qr" class="form-control" placeholder="doctor, patient, department...">
            <button class="btn btn-primary">Search</button>
        </form>
    </div>
    <div class="text-end mb-3">
        <a href="{{ url_for('admin_doctor') }}" class="btn btn-success">Create Doctor</a>
    </div>
    <h5>Registered Doctors</h5>
    <table class="table table-bordered table-sm">
        <thead class="table-light">
            <tr>
                <th>Name</th>
                <th>Specialization</th>
                <th>Department</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for d in doctors %}
        <tr>
            <td>{{ d.user.name }}</td>
            <td>{{ d.specialization }}</td>
            <td>{{ d.department.name if d.department else "N/A" }}</td>
            <td>
                <a href="{{ url_for('edit_doc', doctor_id=d.id) }}" class="btn btn-warning btn-sm">edit</a>

            </form>
                <form method="POST" action="{{ url_for('admin_blacklist_doctor', doctor_id=d.id) }}" style="display:inline;">
                    <button class="btn btn-dark btn-sm">blacklist</button>
                </form>

            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    <h5 class="mt-4">Registered Patients</h5>
    <table class="table table-bordered table-sm">
        <thead class="table-light">
            <tr>
                <th>Name</th>
                <th>Phone</th>
                <th>Gender</th>
                <th>Actions</th>
            </tr>
        </thead>

        <tbody>
        {% for p in patients %}
        <tr>
            <td>{{ p.user.name }}</td>
            <td>{{ p.phone }}</td>
            <td>{{ p.gender }}</td>
            <td>
                <form method="POST" action="{{ url_for('blacklist_patient', patient_id=p.id) }}" style="display:inline;">
                    <button class="btn btn-dark btn-sm">blacklist</button>
                </form>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    <h5 class="mt-4">Upcoming Appointments</h5>
    <table class="table table-bordered table-sm">
        <thead class="table-light">
            <tr>
                <th>Sr No.</th>
                <th>Patient</th>
                <th>Doctor</th>
                <th>Department</th>
                <th>Date</th>
                <th>Time</th>
                <th>History</th>
            </tr>
        </thead>
        <tbody>
        {% for ap in upcoming_appointment %}
        <tr>
            <td>{{ loop.index }}</td>
            <td>{{ ap.patient.user.name }}</td>
            <td>{{ ap.doctor.user.name }}</td>
            <td>{{ ap.doctor.department.name if ap.doctor.department else "N/A" }}</td>
            <td>{{ ap.date }}</td>
            <td>{{ ap.time.strftime("%H:%M") }}</td>
            <td>
                <a href="{{ url_for('admin_patient_history', patient_id=ap.patient.id) }}"
                   class="btn btn-primary btn-sm">view</a>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

</div>

{% endblock %}
